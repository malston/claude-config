# ABOUTME: Docker Compose configuration for Claude Code
# ABOUTME: Provides easy container orchestration with volume mounts and environment variables

services:
  claude:
    build:
      context: .
      dockerfile: Dockerfile
    image: claude-code:latest
    container_name: claude-code

    # Mount your workspace and config
    volumes:
      # Mount your workspace directory (default: ~/workspace, override with WORKSPACE env var)
      - ${WORKSPACE:-~/workspace}:/home/claude/workspace

      # Persist setup state (avoids re-running setup on each container start)
      - claude-state:/home/claude/.claude-state

      # Persist Claude config, marketplaces, and plugins across container restarts
      # On first run, Docker copies image content into empty volume
      - claude-config:/home/claude/.claude

      # Optional: Mount secrets (uncomment if using)
      # - ./config/.env:/home/claude/.claude/config/.env:ro

      # Optional: Mount host dotfiles (uncomment and adjust path)
      # - ~/my-dotfiles:/home/claude/dotfiles

    # Environment variables
    environment:
      # Set to 'auto' to install all configured plugins on startup
      # Set to 'interactive' for guided setup (requires TTY)
      - SETUP_MODE=auto

      # Optional: Anthropic API key
      # - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}

      # Optional: GitHub personal access token for cloning marketplaces and pushing code
      # Generate at: https://github.com/settings/tokens
      - GITHUB_TOKEN=${GITHUB_TOKEN}

      # Optional: Git identity for commits (uses host values if set)
      - GIT_USER_NAME=${GIT_USER_NAME}
      - GIT_USER_EMAIL=${GIT_USER_EMAIL}

      # Optional: Context7 API key for documentation MCP server
      # Get your key at: https://context7.com
      - CONTEXT7_API_KEY=${CONTEXT7_API_KEY}

    # Keep container running for interactive use
    stdin_open: true
    tty: true

    # Override default command for interactive shell
    # command: /bin/bash

    # Network mode
    network_mode: bridge

# Named volumes for persistent data
volumes:
  claude-state:
  claude-config:
